/* artoo.js - A client-side scraping toolbelt. - Version: 0.0.1 -  médialab SciencesPo */
(function(){"use strict";var a=this,b="undefined"!=typeof a.artoo||"undefined"!=typeof a.detoo,c=b&&"detoo"!==a.artoo.passphrase;if(b&&!c&&!a.artoo.debug)return void console.log("An artoo already works within this page. No need to invoke another one.");c&&console.log("An usurper artoo lives within this page. Let's shun it!");var d={$:{},dom:document.getElementById("artoo_injected_script"),hooks:{init:[]},jquery:{"export":function(){a.ß=d.$},plugins:[],version:"2.1.0"},loaded:!1,passphrase:"detoo",settings:{store:localStorage},version:"0.0.1"};d.dom&&(d.debug=!!d.dom.getAttribute("debug"),d.chromeExtension=!!d.dom.getAttribute("chrome"),d.nextScript=d.dom.getAttribute("next")),"undefined"!=typeof this.exports&&("undefined"!=typeof this.module&&this.module.exports&&(this.exports=this.module.exports=d),this.exports.artoo=d),this.artoo=d}).call(this),function(){"use strict";function a(){var a,b,c={},d=arguments.length;for(a=d-1;a>=0;a--)for(b in arguments[a])c[b]=arguments[a][b];return c}function b(a,b){return a.map(function(a){return a.join(b||",")}).join("\n")}function c(a){return artoo.$&&a instanceof artoo.$||ß&&a instanceof ß||jQuery&&a instanceof jQuery||$&&a instanceof $}function d(a){return c(a)?a:artoo.$(a)}function e(a,b){var c=document.createElement("script"),d=document.getElementsByTagName("head")[0],e=!1;c.src=a,c.onload=c.onreadystatechange=function(){e||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(e=!0,c.onload=c.onreadystatechange=null,d.removeChild(c),"function"==typeof b&&b())},d.appendChild(c)}function f(a,b,c){c=c||{},"object"==typeof b&&(c=b,b=c.done);var d=c.interval||30,e=0,f=setInterval(function(){a()&&(b(),clearInterval(f)),c.timeout&&c.timeout-e*d<=0&&(b(!1),clearInterval(f)),e++},d)}artoo.injectScript=e,artoo.waitFor=f,artoo.helpers={extend:a,enforceSelector:d,toCSVString:b}}.call(this),function(a){"use strict";function b(a,b){return Array.prototype.slice.call(a,b||0)}function c(){return['   .-""-.   ',"  /[] _ _\\  "," _|_o_LII|_ ","/ | ==== | \\","|_| ==== |_|"," ||LI  o ||"," ||'----'||","/__|    |__\\"]}function d(a){return["[artoo]: %c"+a,"color: "+f[a]+";","-"]}function e(a){artoo.log[a]=function(){artoo.log.apply(artoo.log,[a].concat(b(arguments)))}}var f={verbose:"#33CCFF",debug:"#000099",info:"#009900",warning:"orange",error:"red"};artoo.log=function(c){var e=f[c]!==a,g=e?1:0,h=b(arguments,g);c=e?c:"debug",console.log.apply(console,d(c).concat(h))};for(var g in f)e(g);artoo.log.welcome=function(){var a=c();a[a.length-2]=a[a.length-2]+"    artoo",console.log(a.join("\n")+"   v"+artoo.version)}}.call(this),function(){"use strict";artoo.jquery.inject=function(a){{var b=artoo.jquery.version,c="//code.jquery.com/jquery-"+b+".min.js",d="undefined"!=typeof jQuery,e=!d&&"function"==typeof $,f=d?jQuery.fn.jquery:"0";"undefined"!=typeof $$&&!!~$$.toString().indexOf("[Command Line API]")}d&&"2"===f.charAt(0)?(artoo.log.verbose("jQuery already exists in this page (v"+f+"). No need to load it again."),artoo.$=jQuery,artoo.jquery.export(),a()):d&&"2"!==f.charAt(0)||e?artoo.injectScript(c,function(){artoo.log.warning("Either jQuery has not a valid version or another library using dollar is already present. Exporting correct version to ß (or artoo.$)."),artoo.$=jQuery.noConflict(!0),artoo.jquery.export(),a()}):artoo.injectScript(c,function(){artoo.log.info("jQuery was correctly injected into your page (v"+b+")."),artoo.$=jQuery,artoo.jquery.export(),a()})}}.call(this),function(a){"use strict";function b(){this.defaultFilename="artoo_data",this.defaultEncoding="utf-8",this.forceDownloadMimeType="application/octet-stream",this.defaultMimeType="text/plain",this.xmlns="http://www.w3.org/1999/xhtml",this.deletionQueue=[],this.mimeShortcuts={csv:"text/csv",json:"application/json",txt:"text/plain",html:"text/html"},this.INIT=0,this.WRITING=1,this.DONE=2,this.createBlob=function(a,b,c){return b=this.mimeShortcuts[b]||b||this.defaultMime,new Blob([a],{type:b+";charset="+c||this.defaultEncoding})},this.blobURL=function(a){var b=d.createObjectURL(a);return this.deletionQueue.push(b),b},this.saveBlob=function(a,b){this.readyState=this.INIT;var d=(a.size,document.createElementNS(this.xmlns,"a")),e=!c.externalHost&&"download"in d;if(e){var f=this.blobURL(a);d.href=f,d.download=b;var g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!1,c,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(g),this.readyState=this.DONE}},this.save=function(a,b){b=b||{};var c=this.createBlob(a,b.mime,b.encoding);this.saveBlob(c,b.filename||this.defaultFilename)}}var c=this,d=(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem,c.URL||c.webkitURL||c),e=new b;artoo.save=function(a,b){e.save(a,b)},artoo.saveJson=function(b,c){c=c||{},"string"!=typeof b?b=c.pretty||c.indent?JSON.stringify(b,a,c.indent||2):JSON.stringify(b):(c.pretty||c.indent)&&(b=JSON.stringify(JSON.parse(b),a,c.indent||2)),this.save(b,this.helpers.extend(c,{filename:"data.json",mime:"json"}))},artoo.savePrettyJson=function(a,b){this.saveJson(a,this.helpers.extend(b,{pretty:!0}))},artoo.saveCsv=function(a,b){a="string"==typeof a?a:this.helpers.toCSVString(a),this.save(a,this.helpers.extend(b,{mime:"csv",filename:"data.csv"}))},artoo.saveHtml=function(b){b.jquery!==a},artoo.savePageHtml=function(a){this.save(document.documentElement.innerHTML,this.helpers.extend(a,{mime:"html",filename:"page.html"}))}}.call(this),function(a){"use strict";function b(b,c){var d,e=artoo.$;return e.isFunction(b)?b.call(c,e):(d=e(c).find(b.sel),b.attr!==a?d.attr(b.attr):d[b.method||"text"]())}artoo.scrape=function(a,c,d){var e=(this.$,[]),f=!!c.sel||"string"==typeof c||"function"==typeof c;d=d||{},c="string"==typeof c?{sel:c,method:"text"}:c;var g=this.helpers.enforceSelector(a);return g.each(function(){var a,d={};if(f)d=b(c,this);else for(a in c)d[a]=b(c[a],this);e.push(d)}),"function"==typeof d.done&&d.done(e),e},artoo.scrap=artoo.scrape}.call(this),function(){"use strict";function a(b,c,d){c=c||0;var e=b.canExpand?"string"==typeof b.canExpand?artoo.$(b.canExpand).length>0:b.canExpand():!0;if(!e||c>=b.limit)return void("function"==typeof b.done&&b.done());var f="string"==typeof b.expand?function(){artoo.$(b.expand).simulate("click")}:b.expand;if(b.throttle?setTimeout(f,b.throttle):f(),b.isExpanding)if("number"==typeof b.isExpanding)setTimeout(a,b.isExpanding,b,++c);else{var g="string"==typeof b.isExpanding?function(){return artoo.$(b.isExpanding).length>0}:b.isExpanding;artoo.waitFor(function(){return!g()},function(){a(b,++c)},{timeout:b.timeout})}else b.elements?(d=d||artoo.$(b.elements).length,artoo.waitFor(function(){return artoo.$(b.elements).length>d},function(){a(b,++c,artoo.$(b.elements).length)},{timeout:b.timeout})):a(b,++c)}artoo.autoExpand=function(b,c){return b=b||{},b.done=c||b.done,b.expand?void a(b):void artoo.log.error("You did not pass an expand parameter to artoo's autoExpand method.")}}.call(this),function(){"use strict";artoo.autoScroll=function(){}}.call(this),function(){"use strict";function a(a,b){return"boolean"===b?a="true"===a:"number"===b?a=+a:"object"===b&&(a=JSON.parse(a)),a}artoo.store={};var b=artoo.settings.store;artoo.store.available="undefined"!=typeof b,artoo.store.available||artoo.hooks.init.push(function(){this.log.warning("localStorage or sessionStorage not available. You might want to upgrade your browser.")}),artoo.store.get=function(c,d){var e=b.getItem(c);return null!==e?a(e,d||"string"):e},artoo.store.getNumber=function(a){return this.get(a,"number")},artoo.store.getBoolean=function(a){return this.get(a,"boolean")},artoo.store.getObject=function(a){return this.get(a,"object")},artoo.store.keys=function(){var a,c=[];for(a in b)c.push(a);return c},artoo.store.getAll=function(){var a={};for(var c in b)a[c]=this.get(c);return a},artoo.store.set=function(a,c,d){return"string"!=typeof a&&"number"!=typeof a?void artoo.log.error("Trying to set an invalid key to store. Keys should be strings or numbers."):void b.setItem(a,d?JSON.stringify(c):""+c)},artoo.store.setObject=function(a,b){this.set(a,b,!0)},artoo.store.push=function(a,b){var c=this.getObject(a);return $.isArray(c)?(c.push(b),void this.setObject(a,c)):void artoo.log.error('Trying to push to a non-array for store key "'+a+'".')},artoo.store.update=function(a,b){var c=this.getObject(a);return artoo.$.isPlainObject(c)?void this.setObject(a,artoo.helpers.extend(b,c)):void artoo.log.error('Trying to update a non-object for store key "'+a+'".')},artoo.store.remove=function(a){b.removeItem(a)},artoo.store.removeAll=function(){for(var a in b)b.removeItem(a)},artoo.s=artoo.store}.call(this),function(){"use strict";function a(){this.log.welcome(),artoo.chromeExtension&&artoo.log.verbose("artoo has automatically been injected by the chrome extension."),this.jquery.inject(function(){artoo.log.info("artoo is now good to go!"),artoo.jquery.plugins.map(function(a){a(artoo.$)}),artoo.nextScript&&artoo.injectScript(artoo.nextScript),artoo.$.isFunction(artoo.ready)&&artoo.ready()}),this.loaded=!0}artoo.hooks.init.unshift(a),artoo.loaded||artoo.hooks.init.map(function(a){a.apply(artoo,a)})}.call(this),function(a){function b(b){b.fn.extend({simulate:function(a,c){return this.each(function(){var d=b.extend({},b.simulate.defaults,c||{});new b.simulate(this,a,d)})}}),b.simulate=function(a,b,c){this.target=a,this.options=c,/^drag$/.test(b)?this[b].apply(this,[this.target,c]):this.simulateEvent(a,b,c)},b.extend(b.simulate.prototype,{simulateEvent:function(a,b,c){var d=this.createEvent(b,c);return this.dispatchEvent(a,b,d,c),d},createEvent:function(a,b){return/^mouse(over|out|down|up|move)|(dbl)?click$/.test(a)?this.mouseEvent(a,b):/^key(up|down|press)$/.test(a)?this.keyboardEvent(a,b):void 0},mouseEvent:function(c,d){{var e,f=b.extend({bubbles:!0,cancelable:"mousemove"!=c,view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:a},d);b(f.relatedTarget)[0]}return b.isFunction(document.createEvent)?(e=document.createEvent("MouseEvents"),e.initMouseEvent(c,f.bubbles,f.cancelable,f.view,f.detail,f.screenX,f.screenY,f.clientX,f.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,f.relatedTarget||document.body.parentNode)):document.createEventObject&&(e=document.createEventObject(),b.extend(e,f),e.button={0:1,1:4,2:2}[e.button]||e.button),e},keyboardEvent:function(c,d){var e,f=b.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:0},d);if(b.isFunction(document.createEvent))try{e=document.createEvent("KeyEvents"),e.initKeyEvent(c,f.bubbles,f.cancelable,f.view,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.keyCode,f.charCode)}catch(g){e=document.createEvent("Events"),e.initEvent(c,f.bubbles,f.cancelable),b.extend(e,{view:f.view,ctrlKey:f.ctrlKey,altKey:f.altKey,shiftKey:f.shiftKey,metaKey:f.metaKey,keyCode:f.keyCode,charCode:f.charCode})}else document.createEventObject&&(e=document.createEventObject(),b.extend(e,f));return b.browser!==a&&(b.browser.msie||b.browser.opera)&&(e.keyCode=f.charCode>0?f.charCode:f.keyCode,e.charCode=a),e},dispatchEvent:function(a,b,c){return a.dispatchEvent?a.dispatchEvent(c):a.fireEvent&&a.fireEvent("on"+b,c),c},drag:function(){var a=this.findCenter(this.target),b=this.options,c=Math.floor(a.x),d=Math.floor(a.y),e=b.dx||0,f=b.dy||0,g=this.target,h={clientX:c,clientY:d};this.simulateEvent(g,"mousedown",h),h={clientX:c+1,clientY:d+1},this.simulateEvent(document,"mousemove",h),h={clientX:c+e,clientY:d+f},this.simulateEvent(document,"mousemove",h),this.simulateEvent(document,"mousemove",h),this.simulateEvent(g,"mouseup",h)},findCenter:function(a){var a=b(this.target),c=a.offset();return{x:c.left+a.outerWidth()/2,y:c.top+a.outerHeight()/2}}}),b.extend(b.simulate,{defaults:{speed:"sync"},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40})}artoo.jquery.plugins.push(b)}.call(this);