/* artoo.js - A client-side scraping toolbelt. - Version: 0.0.1 -  médialab SciencesPo */
(function(){"use strict";var a=this,b=function(c){var d=this;this.$=null,this.version="0.0.1",this.name=c||"artoo",this.passphrase="detoo",this.jquery={version:"2.1.0","export":function(){a.ß=d.$}},this.helpers=b.helpers,this.init()};b.prototype.init=function(){var a=this;this.welcome(),this.inject(function(){a.log(a.name+" is now good to go!")})},"undefined"!=typeof this.exports&&("undefined"!=typeof this.module&&this.module.exports&&(this.exports=this.module.exports=b),this.exports.Artoo=b),this.Artoo=b}).call(this),function(){"use strict";function a(){var a,b,c={},d=arguments.length;for(a=d-1;a>=0;a--)for(b in arguments[a])c[b]=arguments[a][b];return c}function b(a,b){return a.map(function(a){return a.join(b||",")}).join("\n")}Artoo.prototype.getScript=function(a,b){var c=document.createElement("script"),d=document.getElementsByTagName("head")[0],e=!1;c.src=a,c.onload=c.onreadystatechange=function(){e||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(e=!0,c.onload=c.onreadystatechange=null,d.removeChild(c),"function"==typeof b&&b())},d.appendChild(c)},Artoo.helpers={extend:a,toCSVString:b}}.call(this),function(){"use strict";function a(){return['   .-""-.   ',"  /[] _ _\\  "," _|_o_LII|_ ","/ | ==== | \\","|_| ==== |_|"," ||LI  o ||"," ||'----'||","/__|    |__\\"]}Artoo.prototype.log=function(){console.log.apply(console,arguments)},Artoo.prototype.welcome=function(){var b=a();b[b.length-2]=b[b.length-2]+"    "+this.name,console.log(b.join("\n")+"   v"+this.version)}}.call(this),function(){"use strict";Artoo.prototype.inject=function(a){{var b=this,c=this.jquery.version,d="//code.jquery.com/jquery-"+c+".min.js",e="undefined"!=typeof jQuery,f=!e&&"function"==typeof $,g=e?jQuery.fn.jquery:"0";"undefined"!=typeof $$&&!!~$$.toString().indexOf("[Command Line API]")}e&&"2"===g.charAt(0)?(this.log("jQuery already exists in this page (v"+g+"). No need to load it again."),this.$=jQuery,a()):e&&"2"!==g.charAt(0)||f?this.getScript(d,function(){b.log("Either jQuery has not a valid version or another library using dollar is already present.\nExporting correct version to ß (or "+b.name+".$)."),b.$=jQuery.noConflict(),b.jquery.export(),a()}):this.getScript(d,function(){b.log(b.name+" loaded jQuery into your page (v"+c+")."),b.$=jQuery,a()})}}.call(this),function(a){"use strict";function b(){this.defaultFilename="artoo_data",this.defaultEncoding="utf-8",this.forceDownloadMimeType="application/octet-stream",this.defaultMimeType="text/plain",this.xmlns="http://www.w3.org/1999/xhtml",this.deletionQueue=[],this.mimeShortcuts={csv:"text/csv",json:"application/json",txt:"text/plain",html:"text/html"},this.INIT=0,this.WRITING=1,this.DONE=2,this.createBlob=function(a,b,c){return b=this.mimeShortcuts[b]||b||this.defaultMime,new Blob([a],{type:b+";charset="+c||this.defaultEncoding})},this.blobURL=function(a){var b=d.createObjectURL(a);return this.deletionQueue.push(b),b},this.saveBlob=function(a,b){this.readyState=this.INIT;var d=(a.size,document.createElementNS(this.xmlns,"a")),e=!c.externalHost&&"download"in d;if(e){var f=this.blobURL(a);d.href=f,d.download=b;var g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!1,c,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(g),this.readyState=this.DONE}},this.save=function(a,b){b=b||{};var c=this.createBlob(a,b.mime,b.encoding);this.saveBlob(c,b.filename||this.defaultFilename)}}var c=this,d=(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem,c.URL||c.webkitURL||c),e=new b;Artoo.prototype.save=function(a,b){e.save(a,b)},Artoo.prototype.saveJson=function(b,c){"string"!=typeof b?b=c.pretty||c.indent?JSON.stringify(b,a,c.indent||2):JSON.stringify(b):(c.pretty||c.indent)&&(b=JSON.stringify(JSON.parse(b),a,c.indent||2)),this.save(b,this.extend(c,{filename:"data.json",mime:"json"}))},Artoo.prototype.savePrettyJson=function(a,b){this.saveJson(a,this.helpers.extend(b,{pretty:!0}))},Artoo.prototype.saveCsv=function(a,b){a="string"==typeof a?a:this.helpers.toCSVString(a),this.save(a,this.helpers.extend(b,{mime:"csv",filename:"data.csv"}))},Artoo.prototype.saveHtml=function(){},Artoo.prototype.savePageHtml=function(a){this.save(document.documentElement.innerHTML,this.helpers.extend(a,{mime:"html",filename:"page.html"}))}}.call(this),function(){"use strict"}.call(this),function(){"use strict"}.call(this),function(){"use strict";var a,b="undefined"!=typeof this.artoo||"undefined"!=typeof this.detoo,c=b&&"detoo"!==this.artoo.passphrase;return b&&!c?void console.log("An artoo already works within this page.no need to invoke another one."):(c?(console.log('An usurper artoo lives within this page. Renaming artoo to "detoo".'),a="detoo"):a="artoo",void(this[a]=new Artoo(a)))}.call(this);