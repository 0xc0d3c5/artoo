/* artoo.js - The client-side scraping companion. - Version: 0.1.1 - Author: Yomguithereal - medialab SciencesPo */
(function(){"use strict";var a=document.getElementsByTagName("body")[0];a||(a=document.createElement("body"),document.firstChild.appendChild(a));var b={$:{},jquery:{plugins:[]},mountNode:a,version:"0.1.1"};this.artoo=b}).call(this),function(a){function b(b){function c(a){var c,d=b(a.ownerDocument);return a=b(a),c=a.offset(),{x:c.left+a.outerWidth()/2-d.scrollLeft(),y:c.top+a.outerHeight()/2-d.scrollTop()}}var d=/^key/,e=/^(?:mouse|contextmenu)|click/;b.fn.simulate=function(a,c){return this.each(function(){new b.simulate(this,a,c)})},b.simulate=function(a,c,d){var e=b.camelCase("simulate-"+c);this.target=a,this.options=d,this[e]?this[e]():this.simulateEvent(a,c,d)},b.extend(b.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}}),b.extend(b.simulate.prototype,{simulateEvent:function(a,b,c){var d=this.createEvent(b,c);this.dispatchEvent(a,b,d,c)},createEvent:function(a,b){return d.test(a)?this.keyEvent(a,b):e.test(a)?this.mouseEvent(a,b):void 0},mouseEvent:function(c,d){var e,f,g,h;return d=b.extend({bubbles:!0,cancelable:"mousemove"!==c,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:a},d),document.createEvent?(e=document.createEvent("MouseEvents"),e.initMouseEvent(c,d.bubbles,d.cancelable,d.view,d.detail,d.screenX,d.screenY,d.clientX,d.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.button,d.relatedTarget||document.body.parentNode),0===e.pageX&&0===e.pageY&&Object.defineProperty&&(f=e.relatedTarget.ownerDocument||document,g=f.documentElement,h=f.body,Object.defineProperty(e,"pageX",{get:function(){return d.clientX+(g&&g.scrollLeft||h&&h.scrollLeft||0)-(g&&g.clientLeft||h&&h.clientLeft||0)}}),Object.defineProperty(e,"pageY",{get:function(){return d.clientY+(g&&g.scrollTop||h&&h.scrollTop||0)-(g&&g.clientTop||h&&h.clientTop||0)}}))):document.createEventObject&&(e=document.createEventObject(),b.extend(e,d),e.button={0:1,1:4,2:2}[e.button]||e.button),e},keyEvent:function(c,d){var e;if(d=b.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:a},d),document.createEvent)try{e=document.createEvent("KeyEvents"),e.initKeyEvent(c,d.bubbles,d.cancelable,d.view,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.keyCode,d.charCode)}catch(f){e=document.createEvent("Events"),e.initEvent(c,d.bubbles,d.cancelable),b.extend(e,{view:d.view,ctrlKey:d.ctrlKey,altKey:d.altKey,shiftKey:d.shiftKey,metaKey:d.metaKey,keyCode:d.keyCode,charCode:d.charCode})}else document.createEventObject&&(e=document.createEventObject(),b.extend(e,d));return(/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())||"[object Opera]"==={}.toString.call(window.opera))&&(e.keyCode=d.charCode>0?d.charCode:d.keyCode,e.charCode=a),e},dispatchEvent:function(a,b,c){a[b]?a[b]():a.dispatchEvent?a.dispatchEvent(c):a.fireEvent&&a.fireEvent("on"+b,c)},simulateFocus:function(){function a(){d=!0}var c,d=!1,e=b(this.target);e.bind("focus",a),e[0].focus(),d||(c=b.Event("focusin"),c.preventDefault(),e.trigger(c),e.triggerHandler("focus")),e.unbind("focus",a)},simulateBlur:function(){function a(){d=!0}var c,d=!1,e=b(this.target);e.bind("blur",a),e[0].blur(),setTimeout(function(){e[0].ownerDocument.activeElement===e[0]&&e[0].ownerDocument.body.focus(),d||(c=b.Event("focusout"),c.preventDefault(),e.trigger(c),e.triggerHandler("blur")),e.unbind("blur",a)},1)}}),b.extend(b.simulate.prototype,{simulateDrag:function(){var a=0,b=this.target,d=this.options,e=c(b),f=Math.floor(e.x),g=Math.floor(e.y),h=d.dx||0,i=d.dy||0,j=d.moves||3,k={clientX:f,clientY:g};for(this.simulateEvent(b,"mousedown",k);j>a;a++)f+=h/j,g+=i/j,k={clientX:Math.round(f),clientY:Math.round(g)},this.simulateEvent(document,"mousemove",k);this.simulateEvent(b,"mouseup",k),this.simulateEvent(b,"click",k)}})}artoo.jquery.plugins.push(b)}.call(this),function(){"use strict";function a(){return b[Math.floor(Math.random()*b.length)]}var b=["announce","assert","determined","excited","flourish","hello","laugh","music","original","playful","question","quick","sad","sassy","scream","shocked","snappy","strange","talk","threat","weep","welcome","whistling"];artoo.beep=function(c){if(c=c||a(),!~b.indexOf(c))throw Error("artoo.beep: wrong sound specified.");new Audio(artoo.settings.beep.endpoint+c+".ogg").play()},artoo.beep.available=function(){return b},b.forEach(function(a){artoo.beep[a]=function(){artoo.beep(a)}})}.call(this),function(){"use strict";artoo.settings={autoInit:!0,autoExec:!0,chromeExtension:!1,debug:!1,endpoint:null,env:"dev",eval:null,reload:!1,scriptUrl:null,styleSheets:{},templates:{},beep:{endpoint:"//medialab.github.io/artoo/sounds/"},cache:{delimiter:"%"},dependencies:[],instructions:{autoRecord:!0},jquery:{version:"2.1.1",force:!1},log:{beeping:!1,enabled:!0,level:"verbose",welcome:!0},store:{engine:"local"}},artoo.loadSettings=function(a){artoo.settings=artoo.helpers.extend(a,artoo.settings)}}.call(this),function(){"use strict";function a(){var b,c,d={},e=arguments.length;for(b=e-1;b>=0;b--)for(c in arguments[b])d[c]=d[c]&&g(arguments[b][c])?a(arguments[b][c],d[c]):arguments[b][c];return d}function b(){}function c(a,b){var c,d,e=a;if(0>=b)return"";for(d=1,c=0|b;c>d;d++)e+=a;return e}function d(a){return a instanceof Array}function e(a){return a instanceof Object}function f(a){return isNaN(a)&&"number"==typeof a}function g(a){return a instanceof Object&&!(a instanceof Array)&&!(a instanceof Function)}function h(a){return g(a)||d(a)}function i(a){return!h(a)}function j(a,b,c){for(var d=0,e=a.length;e>d;d++)if(b.call(c||null,a[d]))return a[d]}function k(a,b){return b=b||Object.keys(a),b.map(function(b){return a[b]})}function l(a){var b,c,d,e=[];for(d=0,b=a.length;b>d;d++)for(c in a[d])~e.indexOf(c)||e.push(c);return e}function m(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function n(a,b){b=b||{};var c,d=b.headers||[],e=g(a[0]),f=e&&(b.order||l(a)),h=b.escape||'"',i=b.delimiter||",";return d.length||e&&b.headers!==!1&&(d=f),c=(d.length?[d]:[]).concat(e?a.map(function(a){return k(a,f)}):a),c.map(function(a){return a.map(function(a){var b=(""+("undefined"==typeof a?"":a)).replace(new RegExp(m(h),"g"),h+h);return~b.indexOf(i)||~b.indexOf(h)?h+b+h:b}).join(i)}).join("\n")}function o(a,b,c){if("string"==typeof a)return E.string(a);if("number"==typeof a)return E.number(a);if("boolean"==typeof a)return E.boolean(a);if("undefined"==typeof a||null===a||f(a))return E.nullValue(a);if(g(a))return E.object(a,b,c);if(d(a))return E.array(a,b);if("function"==typeof a)return E.fn(a);throw TypeError("artoo.helpers.toYAMLString: wrong type.")}function p(a){return"---\n"+o(a)}function q(a){return artoo.$&&a instanceof artoo.$||jQuery&&a instanceof jQuery||$&&a instanceof $}function r(a){return a instanceof HTMLDocument||a instanceof XMLDocument}function s(a){var b=artoo.$;if("string"!=typeof a)return b(a);try{if(artoo.browser.phantomjs)throw Error("next");return b(b.parseXML(a).documentElement)}catch(c){try{return b(t().documentElement).append(a)}catch(c){return b(a)}}}function t(a,b){return a?document.implementation.createDocument(b||null,a,null):document.implementation.createHTMLDocument()}function u(a,b,c){"function"==typeof b&&(c=b,b=!1);var d=document.createElement("script");d.type="text/javascript",d.src=a,b&&(d.async=!0),d.onload=d.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d.onload=d.onreadystatechange=null,artoo.mountNode.removeChild(d),"function"==typeof c&&c())},artoo.mountNode.appendChild(d)}function v(a,b,c){var d=document.createElement(b?"link":"style"),e=document.getElementsByTagName("head")[0];d.type="text/css",b?(d.href=a,d.rel="stylesheet",d.onload=d.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d.onload=d.onreadystatechange=null,"function"==typeof c&&c())}):d.innerHTML=a,e.appendChild(d)}function w(){var a,b=Object.getPrototypeOf(C),c={};for(a in C)~a.indexOf("webkit")||a in b||C[a]===C||C[a]instanceof BarProp||C[a]instanceof Navigator||~F.indexOf(a)||(c[a]=C[a]);return c}function x(a,b,c){c=c||{},"object"==typeof b&&(c=b,b=c.done);var d=c.interval||30,e=0,f=setInterval(function(){a()&&(b(),clearInterval(f)),c.timeout&&c.timeout-e*d<=0&&(b(!1),clearInterval(f)),e++},d)}function y(){var a=Array.prototype.slice.call(arguments);return setTimeout.apply(null,[a[0],0].concat(a.slice(1)))}function z(a,c,d){function e(){k.forEach(function(a){clearTimeout(a)})}function f(b,c){return l.push(c),b?(e(),j(b,l)):++m>=a.length?j(null,l):(g=a[i++],void k.push(y(g,f)))}var g,h,i,j="function"==typeof c?c:c.done||d,k=[],l=[],m=0;for("function"!=typeof j&&(j=b),i=0,h=c.limit||a.length;h>i;i++)g=a[i],k.push(y(g,f))}function A(a){var b=a.split(".");return 1===b.length||""===b[0]&&2===b.length?"":b.pop()}function B(a){var b=artoo.$(a),c=G[A(b.attr("src"))||"png"],d=document.createElement("canvas");d.width=b[0].naturalWidth,d.height=b[0].naturalHeight;var e=d.getContext("2d");e.drawImage(b[0],0,0);var f=d.toDataURL(c);return d=null,f}var C=this,D=/[:#,\-\[\]\{\}&%]|!{1,2}/,E={string:function(a){return~a.search(D)?"'"+a.replace(/'/g,"''")+"'":a},number:function(a){return""+a},array:function(a,b){if(b=b||0,!a.length)return"[]";var d,e,f="";for(e=0,d=a.length;d>e;e++)f+=c("  ",b),f+=i(a[e])?"- "+o(a[e])+"\n":g(a[e])?"-"+o(a[e],b+1,!0):o(a[e],b+1);return f},object:function(a,b,d){if(b=b||0,!Object.keys(a).length)return(b?"- ":"")+"{}";var e,f,g="",i=0;for(f in a)e=E.string(f),g+=c("  ",b),d&&!i&&(g=g.slice(0,-1)),g+=e+": "+(h(a[f])?"\n":"")+o(a[f],b+1)+"\n",i++;return g},fn:function(a){return E.string(a.toString())},"boolean":function(a){return""+a},nullValue:function(){return"~"}},F=["__commandLineAPI","applicationCache","chrome","closed","console","crypto","CSS","defaultstatus","defaultStatus","devicePixelRatio","document","external","frameElement","history","indexedDB","innerHeight","innerWidth","length","localStorage","location","name","offscreenBuffering","opener","outerHeight","outerWidth","pageXOffset","pageYOffset","performance","screen","screenLeft","screenTop","screenX","screenY","scrollX","scrollY","sessionStorage","speechSynthesis","status","styleMedia"],G={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};artoo.injectScript=function(a,b){u(a,b)},artoo.injectStyle=function(a,b){v(a,!0,b)},artoo.injectInlineStyle=function(a){v(a,!1)},artoo.waitFor=x,artoo.getGlobalVariables=w,artoo.helpers={createDocument:t,extend:a,first:j,getExtension:A,imgToDataUrl:B,isArray:d,isDocument:r,isObject:e,isPlainObject:g,isRealNaN:f,isSelector:q,isNonScalar:h,isScalar:i,jquerify:s,noop:b,parallel:z,toCSVString:n,toYAMLString:p}}.call(this),function(){"use strict";var a=["init","countermeasures","exec","ready"];artoo.hooks={trigger:function(a){if(!artoo.hooks[a])throw Error("artoo.hooks.trigger: inexistant hook");artoo.hooks[a].forEach(function(a){a.apply(artoo)})}},a.forEach(function(a){artoo.hooks[a]=[]}),artoo.ready=function(a){if("function"!=typeof a)throw Error("artoo.ready: trying to register a non-function.");artoo.hooks.ready.push(a)}}.call(this),function(){"use strict";function a(){var a=!0;for(var b in c.console.__proto__){a=!1;break}return a}function b(){return"undefined"==typeof window&&"undefined"!=typeof global&&"undefined"!=typeof module&&module.exports}var c=this,d="navigator"in c;artoo.browser={chrome:"chrome"in c,firefox:d&&!!~navigator.userAgent.search(/firefox/i),phantomjs:"callPhantom"in c,nodejs:b()},artoo.browser.which=artoo.helpers.first(Object.keys(artoo.browser),function(a){return artoo.browser[a]})||null,artoo.browser.firebug=a()}.call(this),function(a){"use strict";function b(a,b){return Array.prototype.slice.call(a,b||0)}function c(a){return artoo.helpers.isArray(h.level)?!!~h.level.indexOf(a):j.indexOf(a)>=j.indexOf(h.level)}function d(){return[(g?" ":"")+'  .-""-.   ',"  /[] _ _\\  "," _|_o_LII|_ ","/ | ==== | \\","|_| ==== |_|"," ||LI  o ||"," ||'----'||","/__|    |__\\"]}function e(a){var b=["[artoo]: "+(g?"%c"+a:"")];return g&&b.push("color: "+i[a]+";"),b.push("-"+(g?"":" ")),b}function f(a){artoo.log[a]=function(){artoo.log.apply(artoo.log,[a].concat(b(arguments)))}}var g=artoo.browser.chrome||artoo.browser.firebug,h=artoo.settings.log,i={verbose:"#33CCFF",debug:"#000099",info:"#009900",warning:"orange",error:"red"},j=["verbose","debug","info","warning","error"];artoo.log=function(d){if(h.enabled){var f=i[d]!==a,j=f?1:0,k=b(arguments,j);if(d=f?d:"debug",c(d)){var l=e(d).concat(k);console.log.apply(console,g?l:[l.reduce(function(a,b){return a+b},"")])}}};for(var k in i)f(k);artoo.log.plain=function(){h.enabled&&console.log.apply(console,arguments)},artoo.log.welcome=function(){if(h.enabled){var a=d();a[a.length-2]=a[a.length-2]+"    artoo.js",console.log(a.join("\n")+"   v"+artoo.version)}}}.call(this),function(){"use strict";var a=this,b={};artoo.deps={},artoo.deps._inject=function(c){var d=artoo.settings.dependencies;if(!d.length)return c();artoo.log.verbose("Starting to retrieve dependencies...",d.map(function(a){return a.name}));var e=d.map(function(c){if(!c.name||!c.globals||!c.url)throw Error("artoo.deps: invalid dependency definition.");var d="string"==typeof c.globals?[c.globals]:c.globals;return d.forEach(function(d){!a[d]||c.noConflict||c.force||(b[d]=a[d])}),function(e){artoo.injectScript(c.url,function(){artoo.log.verbose("Retrieved dependency "+c.name);var f={};d.forEach(function(d){f[d]=a[d],b[d]&&(a[d]=b[d],delete b[d]),c.noConflict&&a[d].noConflict()}),artoo.deps[c.name]=Object.keys(f).length>1?f:f[Object.keys(f)[0]],e()})}});artoo.helpers.parallel(e,function(){artoo.log.verbose("Finished retrieving dependencies."),c()})},artoo.jquery.inject=function(b){var c=artoo.settings.jquery.version,d="//code.jquery.com/jquery-"+c+".min.js",e="undefined"!=typeof jQuery,f=!e&&"function"==typeof $,g=e&&jQuery.fn.jquery?jQuery.fn.jquery:"0";e&&g.charAt(0)===c.charAt(0)?(artoo.log.verbose("jQuery already exists in this page (v"+g+"). No need to load it again."),artoo.$=jQuery,b()):artoo.settings.jquery.force?artoo.injectScript(d,function(){artoo.log.warning("According to your settings, jQuery (v"+c+") was injected into your page to replace the current $ variable."),artoo.$=jQuery,b()}):e&&"2"!==g.charAt(0)||f?artoo.injectScript(d,function(){artoo.$=jQuery.noConflict(!0),"undefined"==typeof a.$?(a.$=artoo.$,artoo.log.warning("jQuery is available but does not have a correct version. The correct version was therefore injected and $ was set since it was not used.")):artoo.log.warning("Either jQuery has not a valid version or another library using $ is already present. Correct version available through `artoo.$`."),b()}):artoo.injectScript(d,function(){artoo.log.info("jQuery was correctly injected into your page (v"+c+")."),artoo.$=jQuery,b()})}}.call(this),function(){"use strict";function a(){artoo.browser.firebug||~console.log.toString().search(/\[native code\]/i)||(["log","info","debug","warn"].forEach(function(a){console[a]=console.__proto__[a]}),artoo.log.warning("The console have been shunted by the website you are visiting. artoo has repaired it."))}artoo.hooks.countermeasures=artoo.hooks.countermeasures.concat([a])}.call(this),function(){"use strict";function a(){g||(XMLHttpRequest.prototype.send=function(){var a,b=this;for(a in d)d[a](b);f.apply(this,arguments)},g=!0)}function b(){g&&(XMLHttpRequest.prototype.send=f,g=!1)}function c(a){this.id=a,this.detach=function(){delete d[this.id],Object.keys(d).length||b()}}artoo.sniffers={};var d={},e=0,f=XMLHttpRequest.prototype.send,g=!1;artoo.sniffers.ajaxRequest=function(b){if("function"!=typeof b)throw TypeError("artoo.sniffers.ajaxRequest:argument given is not a function.");a();var f=e++;return d[f]=b,new c(f)},artoo.sniffers.ajaxComplete=function(a){if("function"!=typeof a)throw TypeError("artoo.sniffers.ajaxComplete:argument given is not a function.");return artoo.sniffers.ajaxRequest(function(b){var c=b.onreadystatechange;b.onreadystatechange=function(){4===b.readyState&&a(b),"function"==typeof c&&c.apply(b,arguments)}})},artoo.sn=artoo.sniffers}.call(this),function(){"use strict";function a(b,c,d,e,f){function g(a){i.settings||c.settings?artoo.$.ajax(i.url||c.url||i,artoo.helpers.extend(i.settings||c.settings,{success:a,data:i.data||c.data||{},type:i.method||c.method||"get"})):artoo.$[i.method||c.method||"get"](i.url||c.url||i,i.data||c.data||{},a)}function h(f){var g=f;return(c.scrape||c.jquerify)&&(f=artoo.helpers.jquerify(f)),c.scrape||c.scrapeOne?g=artoo[c.scrape?"scrape":"scrapeOne"](f.find(c.scrape.iterator),c.scrape.data,c.scrape.params):"function"==typeof c.process&&(g=c.process(f,d,e)),g===!1?c.done(e):(c.concat?e=e.concat(g):e.push(g),d++,void(artoo.helpers.isArray(b)&&d===b.length||d===c.limit?c.done(e):a(b,c,d,e,f)))}e=e||[],d=d||0;var i="function"==typeof b?b(d,f):b[d];return i?void(c.throttle>0?setTimeout(g,d?c.throttle:0,h):"function"==typeof c.throttle?setTimeout(g,d?c.throttle(d):0,h):g(h)):c.done(e)}artoo.ajaxSpider=function(b,c,d){var e,f;c=c||{},"function"==typeof c&&(e=c,c={},c.done=e),"function"==typeof d&&(f=artoo.helpers.extend({done:d},c)),a(b,artoo.helpers.extend(f||c,{done:artoo.helpers.noop}))}}.call(this),function(){"use strict";function a(b,c,d){c=c||0;var e=b.canExpand?"string"==typeof b.canExpand?artoo.$(b.canExpand).length>0:b.canExpand(artoo.$):!0;if(!e||c>=b.limit)return void("function"==typeof b.done&&b.done());var f="string"==typeof b.expand?function(){artoo.$(b.expand).simulate("click")}:b.expand;if(b.throttle?setTimeout(f,"function"==typeof b.throttle?b.throttle(c):b.throttle,artoo.$):f(artoo.$),b.isExpanding)if("number"==typeof b.isExpanding)setTimeout(a,b.isExpanding,b,++c);else{var g="string"==typeof b.isExpanding?function(){return artoo.$(b.isExpanding).length>0}:b.isExpanding;artoo.waitFor(function(){return!g(artoo.$)},function(){a(b,++c)},{timeout:b.timeout})}else b.elements?(d=d||artoo.$(b.elements).length,artoo.waitFor(function(){return artoo.$(b.elements).length>d},function(){a(b,++c,artoo.$(b.elements).length)},{timeout:b.timeout})):a(b,++c)}artoo.autoExpand=function(b,c){if(b=b||{},b.done=c||b.done,!b.expand)throw Error("artoo.autoExpand: you must provide an expand parameter.");a(b)}}.call(this),function(){"use strict";artoo.autoScroll=function(a,b){artoo.autoExpand(this.helpers.extend(a,{expand:function(){window.scrollTo(0,document.body.scrollHeight)}}),b)}}.call(this),function(){"use strict";function a(){var a=this;this.opened=!1,this.db=null,this.collections={},this.open=function(){var b=indexedDB.open("artoo"),c=artoo.$.Deferred();return this.opened?c.resolve(this.db):(b.onsuccess=function(b){a.opened=!0,a.db=b.target.result,c.resolve(a.db)},b.onerror=function(a){c.reject(a.target.error)}),c},this.objectStore=function(c,d){function e(){a.collections[c]=new b(c,d,a.db),f.resolve(a.collections[c])}d=d||{keyPath:"id",autoIncrement:!0};var f=artoo.$.Deferred();return this.open().then(function(){if(c in a.collections)f.resolve(a.collections[c]);else if(a.db.objectStoreNames.contains(c))e();else{a.db.close();var b=indexedDB.open("artoo",a.db.version+1);b.onupgradeneeded=function(a){a.target.result.createObjectStore(c,d)},b.onsuccess=function(b){a.db=b.target.result,e()},b.onerror=function(a){f.reject(a.target.error)},b.onblocked=function(){f.reject("blocked")}}}),f}}function b(a,b,c){this.name=a,this.params=b,this.transaction=function(a){return a=a||"readonly",c.transaction([this.name],a)},this.add=function(a,b){var c=this.transaction("readwrite").objectStore(this.name).add(a);c.onsuccess=function(a){"function"==typeof b&&b(null,a.target.result)},c.onerror=function(a){"function"==typeof b&&b(a.target.error)}},this.get=function(a,b){var c=this.transaction().objectStore(this.name).get(a);c.onsuccess=function(a){"function"==typeof b&&b(null,a.target.result||null)},c.onerror=function(a){b(a.target.error)}}}var c=this;if("indexedDB"in c){var d=new a;artoo.db=function(a,b,c){return artoo.db.open(a,b,c)},artoo.db.open=function(a,b,c){"function"==typeof b&&(c=b),b=null,d.objectStore(a,b).then(c)}}}.call(this),function(){function a(){Function.prototype.call=function(){if(arguments.length>1&&"evaluate"===this.name&&"InjectedScriptHost"===arguments[0].constructor.name){var a=arguments[1].split("\n").slice(1,-1).join("\n"),b=d.length-1;"this"===a||e.some(function(b){return~a.indexOf(b)})||"artoo"===a||(~a.indexOf(d[b])?d[b]=a:d.push(a))}return c.apply(this,arguments)}}function b(){Function.prototype.call=c}var c=Function.prototype.call,d=[],e=["saveInstructions(",".instructions"];artoo.instructions=function(){return artoo.instructions.get()},artoo.instructions.get=function(){return artoo.browser.chrome||artoo.log.warning("You are not in chrome. artoo is therefore unable to record console's instructions."),d=d.filter(function(a,b){return a!==d[b-1]})},artoo.instructions.getScript=function(){return"// "+window.location+"\n// "+new Date+"\n"+artoo.instructions.get().join("\n\n")+"\n"},artoo.instructions.startRecording=function(){artoo.browser.chrome&&a()},artoo.instructions.stopRecording=function(){artoo.browser.chrome&&b()}}.call(this),function(a){"use strict";function b(a){return a[0].documentElement&&a[0].documentElement.outerHTML||a[0].outerHTML}function c(a){return"string"==typeof a?{filename:a}:a||{}}function d(){this.defaultFilename="artoo_data",this.defaultEncoding="utf-8",this.forceDownloadMimeType="application/octet-stream",this.defaultMimeType="text/plain",this.xmlns="http://www.w3.org/1999/xhtml",this.mimeShortcuts={csv:"text/csv",tsv:"text/tab-separated-values",json:"application/json",txt:"text/plain",html:"text/html",yaml:"text/yaml"},this.createBlob=function(a,b,c){return b=this.mimeShortcuts[b]||b||this.defaultMime,new Blob([a],{type:b+";charset="+c||this.defaultEncoding})},this.createBlobFromDataURL=function(a){var b,c,d=atob(a.split(",")[1]),e=new Uint8Array(d.length);for(b=0,c=d.length;c>b;b++)e[b]=d.charCodeAt(b);return new Blob([e.buffer],{type:a.split(",")[0].split(":")[1].split(";")[0]})},this.blobURL=function(a){var b=g.createObjectURL(a);return b},this.saveResource=function(a,b){var c=document.createElementNS(this.xmlns,"a");c.href=a,c.setAttribute("download",b.filename||""),artoo.$(c).simulate("click"),c=null,b.revoke&&g.revokeObjectURL(a)},this.saveData=function(a,b){b=b||{};var c=this.createBlob(a,b.mime,b.encoding);this.saveResource(this.blobURL(c),{filename:b.filename||this.defaultFilename,revoke:b.revoke||!0})},this.saveDataURL=function(a,b){b=b||{};var c=this.createBlobFromDataURL(a);this.saveResource(c,{filename:b.filename||this.defaultFilename})}}var e=this,f=artoo.helpers,g=e.URL||e.webkitURL||e,h=new d;artoo.save=function(a,b){h.saveData(a,c(b))},artoo.saveJson=function(b,d){d=c(d),"string"!=typeof b?b=d.pretty||d.indent?JSON.stringify(b,a,d.indent||2):JSON.stringify(b):(d.pretty||d.indent)&&(b=JSON.stringify(JSON.parse(b),a,d.indent||2)),artoo.save(b,f.extend(d,{filename:"data.json",mime:"json"}))},artoo.savePrettyJson=function(a,b){b=c(b),artoo.saveJson(a,f.extend(b,{pretty:!0}))},artoo.saveYaml=function(a,b){b=c(b),artoo.save(f.toYAMLString(a),f.extend(b,{filename:"data.yml",mime:"yaml"}))},artoo.saveCsv=function(a,b){b=c(b),a="string"!=typeof a?f.toCSVString(a,b):a,artoo.save(a,f.extend(b,{mime:"csv",filename:"data.csv"}))},artoo.saveTsv=function(a,b){artoo.saveCsv(a,f.extend(c(b),{mime:"tsv",delimiter:" ",filename:"data.tsv"}))},artoo.saveXml=function(a,d){d=c(d);var e=f.isSelector(a)&&b(a)||f.isDocument(a)&&a.documentElement.outerHTML||a,g=d.type||"xml",h="";if("html"===g&&f.isDocument(a)){var i=a.doctype;i&&(h="<!DOCTYPE "+(i.name||"html")+(i.publicId?' PUBLIC "'+i.publicId+'"':"")+(i.systemId?' "'+i.systemId+'"':"")+">\n")}else("xml"===g||"svg"===g)&&(~e.search(/<\?xml/)||(h='<?xml version="1.0" encoding="'+(d.encoding||"utf-8")+'" standalone="yes"?>\n'));"svg"===g&&(h+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'),artoo.save(h+e,f.extend(d,{mime:"html",filename:"document.xml"}))},artoo.saveHtml=function(a,b){artoo.saveXml(a,f.extend(c(b),{filename:"document.html",type:"html"}))},artoo.savePageHtml=function(a){artoo.saveHtml(document,f.extend(c(a),{filename:"page.html"}))},artoo.saveSvg=function(a,b){b=c(b);var d=artoo.$(a);if(!d.is("svg"))throw Error("artoo.saveSvg: selector is not svg.");artoo.saveXml(d,f.extend(b,{filename:"drawing.svg",type:"svg"}))},artoo.saveStore=function(a){a=c(a),artoo.savePrettyJson(artoo.store.get(a.key),f.extend(a,{filename:"store.json"}))},artoo.saveInstructions=function(a){artoo.save(artoo.instructions.getScript(),f.extend(c(a),{mime:"text/javascript",filename:"artoo_script.js"}))},artoo.saveResource=function(a,b){h.saveResource(a,c(b))},artoo.saveImage=function(a,b){b=c(b);var d=artoo.$(a);if(!d.is("img")&&!d.attr("src"))throw Error("artoo.saveImage: selector is not an image.");var e=f.getExtension(d.attr("src")),g=d.attr("alt");artoo.saveResource(d.attr("src"),f.extend(b,{filename:g?g+(e?"."+e:""):!1}))}}.call(this),function(a){"use strict";function b(b,c){var d,e=artoo.$,f=b.sel?e(c).find(b.sel):e(c);return d="function"==typeof b?b.call(c,e):"function"==typeof b.method?b.method.call(f.get(),e):"string"==typeof b?"function"==typeof f[b]?f[b]():f.attr(b):b.attr!==a?f.attr(b.attr):f[b.method||"text"](),b.defaultValue&&!d&&(d=b.defaultValue),d}function c(a,d,e,f){var g=[],h=!!d.attr||!!d.method||d.scrape||"string"==typeof d||"function"==typeof d;e=e||{};var i;return i=artoo.$("function"==typeof a?a(artoo.$):a),i.each(function(a){var f,i={};if(h)i="object"==typeof d&&"scrape"in d?c($(this).find(d.scrape.iterator),d.scrape.data,d.scrape.params):b(d,this);else for(f in d)i[f]="object"==typeof d[f]&&"scrape"in d[f]?c($(this).find(d[f].scrape.iterator),d[f].scrape.data,d[f].scrape.params):b(d[f],this);return g.push(i),!e.limit||a<e.limit-1}),g=e.one?g[0]:g,"function"==typeof f&&f(g),g}function d(a,b,c,d){var e,f,g,h;return artoo.helpers.isPlainObject(a)&&!artoo.helpers.isSelector(a)&&!artoo.helpers.isDocument(a)&&(a.iterator||a.data||a.params)?(f=a.data,g=artoo.helpers.isPlainObject(a.params)?a.params:{},e=a.iterator):(f=b,g=artoo.helpers.isPlainObject(c)?c:{},e=a),f=f||"text",h="function"==typeof d?d:"function"==typeof c?c:g.done,[e,f,g,h]}artoo.helpers.extend;artoo.scrape=function(a,b,e,f){var g=d(a,b,e,f);if(!g[0]||!g[1])throw TypeError("artoo.scrape: wrong arguments.");return c.apply(this,g)},artoo.scrapeOne=function(a,b,e,f){var g=d(a,b,e,f);return g[2]=artoo.helpers.extend(g[2],{limit:1,one:!0}),c.apply(this,g)},artoo.scrapeTable=function(a,c,d){c=c||{};var e;if(c.headers){var f=c.headers.type||c.headers.method&&"first"||c.headers,g=c.headers.method;if("th"===f)e=artoo.scrape(a+" th",g||"text");else if("first"===f)e=artoo.scrape(a+" tr:has(td):first td",g||"text");else{if(!artoo.helpers.isArray(f))throw TypeError("artoo.scrapeTable: wrong headers type.");e=f}return artoo.scrape(a+" tr:has(td)"+("first"===f?":not(:first)":""),function(){var a={};return e.forEach(function(d,e){a[d]=b(c.data||"text",$(this).find("td:eq("+e+")"))},this),a},c,d)}return artoo.scrape(a+" tr:has(td)",{scrape:{iterator:"td",data:c.data||"text"}},c,d)}}.call(this),function(){"use strict";function a(a){var b=artoo.settings.cache.delimiter;return a.charAt(0)===b&&a.charAt(a.length-1)===b}function b(a){if("local"===a)c=localStorage;else{if("session"!==a)throw Error('artoo.store: wrong engine "'+a+'".');c=sessionStorage}}var c;b(artoo.settings.store.engine),artoo.store=function(a){return artoo.store.get(a)},artoo.store.get=function(a){if(!a)return artoo.store.getAll();var b=c.getItem(a);try{return JSON.parse(b)}catch(d){return b}},artoo.store.getAll=function(){var b={};for(var d in c)a(d)||(b[d]=artoo.store.get(d));return b},artoo.store.keys=function(){var a,b=[];for(a in c)b.push(a);return b},artoo.store.set=function(a,b){if("string"!=typeof a&&"number"!=typeof a)throw TypeError("artoo.store.set: trying to set an invalid key.");c.setItem(a,JSON.stringify(b))},artoo.store.pushTo=function(a,b){var c=artoo.store.get(a);if(!artoo.helpers.isArray(c)&&null!==c)throw TypeError("artoo.store.pushTo: trying to push to a non-array.");return c=c||[],c.push(b),artoo.store.set(a,c),c},artoo.store.update=function(a,b){var c=artoo.store.get(a);if(!artoo.helpers.isPlainObject(c)&&null!==c)throw TypeError("artoo.store.update: trying to udpate to a non-object.");return c=artoo.helpers.extend(b,c),artoo.store.set(a,c),c},artoo.store.remove=function(a){c.removeItem(a)},artoo.store.removeAll=function(){for(var b in c)a(b)||c.removeItem(b)},artoo.s=artoo.store,artoo.store.clean=artoo.store.removeAll}.call(this),function(){"use strict";var a=0;artoo.ui=function(){var b="artoo-ui"+a++;this.host=document.createElement("div"),this.host.setAttribute("id",b),artoo.mountNode.appendChild(this.host),this.shadow=this.host.createShadowRoot(),this.$=function(a){return a?artoo.$(this.shadow).children(a).add(artoo.$(this.shadow).children().find(a)):artoo.$(this.shadow)},this.injectInlineStyle=function(a){var b=document.createElement("style");return b.innerText=a,this.shadow.appendChild(b),this},this.kill=function(){artoo.mountNode.removeChild(this.host),delete this.shadow,delete this.host}}}.call(this),function(){"use strict";function a(){artoo.settings.eval?(artoo.log.verbose("evaluating and executing the script given to artoo."),eval.call(c,JSON.parse(artoo.settings.eval))):artoo.settings.scriptUrl&&(artoo.log.verbose('executing script at "'+artoo.settings.scriptUrl+'"'),artoo.injectScript(artoo.settings.scriptUrl))}function b(){function a(a){artoo.jquery.inject(function(){artoo.jquery.plugins.map(function(a){a(artoo.$)}),a()})}artoo.hooks.trigger("countermeasures"),artoo.settings.log.welcome&&artoo.log.welcome(),artoo.settings.log.beeping&&artoo.beep("original"),artoo.browser.chromeExtension&&artoo.log.verbose("artoo has automatically been injected by the chrome extension."),artoo.settings.instructions.autoRecord&&artoo.instructions.startRecording(),artoo.helpers.parallel([a,artoo.deps._inject],function(){artoo.log.info("artoo is now good to go!"),artoo.settings.autoExec&&artoo.exec(),artoo.hooks.trigger("ready")}),artoo.loaded=!0}var c=this,d=document.getElementById("artoo_injected_script");d&&(artoo.loadSettings(JSON.parse(d.getAttribute("settings"))),d.parentNode.removeChild(d)),artoo.browser.chromeExtension=!!artoo.settings.chromeExtension,artoo.hooks.init.unshift(b),artoo.hooks.exec.unshift(a),artoo.init=function(){artoo.hooks.trigger("init")},artoo.exec=function(){artoo.hooks.trigger("exec")},artoo.settings.autoInit&&artoo.init()}.call(this);