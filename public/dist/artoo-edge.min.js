/* artoo.js - The client-side scraping companion. - Version: 0.3.0 - Author: Yomguithereal - medialab SciencesPo */
(function(){"use strict";var t;"document"in this&&(t=document.getElementsByTagName("body")[0],t||(t=document.createElement("body"),document.documentElement.appendChild(t)));var e={$:{},jquery:{plugins:[]},mountNode:t,stylesheets:{},templates:{},_handlers:{},_handlersAll:[]};Object.defineProperty(e,"version",{value:"0.3.0"}),this.artoo=e}).call(this),function(){"use strict";var t=function(){this._handlers={},this._handlersAll=[]};t.prototype.on=function(e,o,n){var r,a,i,s,l=arguments[arguments.length-1];if("boolean"==typeof l?(n=l,arguments.length--):n=!1,1===arguments.length&&"object"==typeof arguments[0])for(i in arguments[0])t.prototype.on.call(this,i,arguments[0][i],n);else if(1===arguments.length&&"function"==typeof arguments[0])this._handlersAll.push({handler:arguments[0]});else{if(2!==arguments.length||"function"!=typeof arguments[1])throw new Error("Wrong arguments.");for(s="string"==typeof e?[e]:e,r=0,a=s.length;r!==a;r+=1)i=s[r],i&&(this._handlers[i]||(this._handlers[i]=[]),this._handlers[i].push({once:!!n,handler:o}))}return this},t.prototype.once=function(){var t=Array.prototype.slice.call(arguments).concat(!0);return this.on.apply(this,t)},t.prototype.off=function(t,e,o){var n,r,a,i,s,l,c,u=arguments[arguments.length-1],f="string"==typeof t?[t]:t;if("boolean"==typeof u?(o=u,arguments.length--):o=!1,arguments.length){if(1===arguments.length&&"function"!=typeof f)for(n=0,r=f.length;n!==r;n+=1)delete this._handlers[f[n]];else if(1===arguments.length&&"function"==typeof f){e=arguments[0];for(s in this._handlers){for(l=[],n=0,r=this._handlers[s].length;n!==r;n+=1)this._handlers[s][n].handler!==e&&l.push(this._handlers[s][n]);this._handlers[s]=l}for(l=[],n=0,r=this._handlersAll.length;n!==r;n+=1)this._handlersAll[n].handler!==e&&l.push(this._handlersAll[n]);this._handlersAll=l}else if(2===arguments.length)for(n=0,r=f.length;n!==r;n+=1){if(c=f[n],this._handlers[c]){for(l=[],a=0,i=this._handlers[c].length;a!==i;a+=1)(this._handlers[c][a].handler!==e||o&&!this._handlers[c][a].once)&&l.push(this._handlers[c][a]);this._handlers[c]=l}this._handlers[c]&&0===this._handlers[c].length&&delete this._handlers[c]}}else{this._handlersAll=[];for(s in this._handlers)delete this._handlers[s]}return this},t.prototype.emit=function(t,e){var o,n,r,a,i,s,l,c="string"==typeof t?[t]:t;for(e=void 0===e?{}:e,o=0,n=c.length;o!==n;o+=1)if(l=c[o],s=(this._handlers[l]||[]).concat(this._handlersAll),s.length)for(i={type:l,data:e||{},target:this},r=0,a=s.length;r!==a;r+=1)s[r].handler.call(this,i),s[r].once&&this.off(l,s[r].handler,!0);return this},t.prototype.binder=function(){var t=new e(this);return arguments.length&&t.on.apply(t,arguments),t};var e=function(e){t.call(this),this._emitter=e,this._enabled=!0};e.prototype.on=function(){return t.prototype.on.apply(this,arguments),this._enabled&&this._emitter.on.apply(this._emitter,arguments),this},e.prototype.once=function(){var e=Array.prototype.slice.call(arguments).concat(!0);return t.prototype.on.apply(this,e),this._enabled&&this._emitter.on.apply(this._emitter,e),this},e.prototype.off=function(){return t.prototype.off.apply(this,arguments),this._enabled&&this._emitter.off.apply(this._emitter,arguments),this},e.prototype.enable=function(){var t,e,o;if(this._enabled)return this;for(this._enabled=!0,e=this._handlersAll,o=e.length-1;o>=0;o--)this._emitter.on(e[o].handler);for(t in this._handlers)for(e=this._handlers[t],o=e.length-1;o>=0;o--)this._emitter.on(t,e[o].handler);return this},e.prototype.disable=function(){function t(t){return t.handler===n[e].handler}var e,o,n;if(!this._enabled)return this;for(n=this._emitter._handlersAll,e=n.length-1;e>=0;e--)this._handlersAll.find(t)&&n.splice(e,1);for(o in this._handlers)for(n=this._handlers[o],e=n.length-1;e>=0;e--)this._emitter.off(o,n[e].handler);return this._enabled=!1,this},t.version="1.0.0",artoo.emitter=t}.call(this),function(t){function e(e){function o(t){var o,n=e(t.ownerDocument);return t=e(t),o=t.offset(),{x:o.left+t.outerWidth()/2-n.scrollLeft(),y:o.top+t.outerHeight()/2-n.scrollTop()}}function n(t){var o,n=e(t.ownerDocument);return t=e(t),o=t.offset(),{x:o.left-n.scrollLeft(),y:o.top-n.scrollTop()}}var r=/^key/,a=/^(?:mouse|contextmenu)|click/;e.fn.simulate=function(t,o){return this.each(function(){new e.simulate(this,t,o)})},e.simulate=function(t,o,n){var r=e.camelCase("simulate-"+o);this.target=t,this.options=n,this[r]?this[r]():this.simulateEvent(t,o,n)},e.extend(e.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}}),e.extend(e.simulate.prototype,{simulateEvent:function(t,e,o){var n=this.createEvent(e,o);this.dispatchEvent(t,e,n,o)},createEvent:function(t,e){return r.test(t)?this.keyEvent(t,e):a.test(t)?this.mouseEvent(t,e):void 0},mouseEvent:function(o,n){var r,a,i,s;return n=e.extend({bubbles:!0,cancelable:"mousemove"!==o,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:t},n),document.createEvent?(r=document.createEvent("MouseEvents"),r.initMouseEvent(o,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget||document.body.parentNode),0===r.pageX&&0===r.pageY&&Object.defineProperty&&(a=r.relatedTarget.ownerDocument||document,i=a.documentElement,s=a.body,Object.defineProperty(r,"pageX",{get:function(){return n.clientX+(i&&i.scrollLeft||s&&s.scrollLeft||0)-(i&&i.clientLeft||s&&s.clientLeft||0)}}),Object.defineProperty(r,"pageY",{get:function(){return n.clientY+(i&&i.scrollTop||s&&s.scrollTop||0)-(i&&i.clientTop||s&&s.clientTop||0)}}))):document.createEventObject&&(r=document.createEventObject(),e.extend(r,n),r.button={0:1,1:4,2:2}[r.button]||(-1===r.button?0:r.button)),r},keyEvent:function(o,n){var r;if(n=e.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:t},n),document.createEvent)try{r=document.createEvent("KeyEvents"),r.initKeyEvent(o,n.bubbles,n.cancelable,n.view,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode)}catch(a){r=document.createEvent("Events"),r.initEvent(o,n.bubbles,n.cancelable),e.extend(r,{view:n.view,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,metaKey:n.metaKey,keyCode:n.keyCode,charCode:n.charCode})}else document.createEventObject&&(r=document.createEventObject(),e.extend(r,n));return(/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())||"[object Opera]"==={}.toString.call(window.opera))&&(r.keyCode=n.charCode>0?n.charCode:n.keyCode,r.charCode=t),r},dispatchEvent:function(t,e,o){t[e]?t[e]():t.dispatchEvent?t.dispatchEvent(o):t.fireEvent&&t.fireEvent("on"+e,o)},simulateFocus:function(){function t(){n=!0}var o,n=!1,r=e(this.target);r.bind("focus",t),r[0].focus(),n||(o=e.Event("focusin"),o.preventDefault(),r.trigger(o),r.triggerHandler("focus")),r.unbind("focus",t)},simulateBlur:function(){function t(){n=!0}var o,n=!1,r=e(this.target);r.bind("blur",t),r[0].blur(),setTimeout(function(){r[0].ownerDocument.activeElement===r[0]&&r[0].ownerDocument.body.focus(),n||(o=e.Event("focusout"),o.preventDefault(),r.trigger(o),r.triggerHandler("blur")),r.unbind("blur",t)},1)}}),e.extend(e.simulate.prototype,{simulateDrag:function(){var r=0,a=this.target,i=this.options,s="corner"===i.handle?n(a):o(a),l=Math.floor(s.x),c=Math.floor(s.y),u={clientX:l,clientY:c},f=i.dx||(i.x!==t?i.x-l:0),h=i.dy||(i.y!==t?i.y-c:0),p=i.moves||3;for(this.simulateEvent(a,"mousedown",u);p>r;r++)l+=f/p,c+=h/p,u={clientX:Math.round(l),clientY:Math.round(c)},this.simulateEvent(a.ownerDocument,"mousemove",u);e.contains(document,a)?(this.simulateEvent(a,"mouseup",u),this.simulateEvent(a,"click",u)):this.simulateEvent(document,"mouseup",u)}})}artoo.jquery.plugins.push(e)}.call(this),function(){"use strict";function t(t){return t[Math.floor(Math.random()*t.length)]}var e={greet:["announce","excited","hello","music","original","welcome"],info:["determined","flourish","playful","sassy","talk","whistling"],warn:["assert","laugh","question","quick","strange","threat"],error:["sad","scream","shocked","weep"]},o=e.greet.concat(e.info).concat(e.warn).concat(e.error);artoo.beep=function(n){var r;if(r=artoo.helpers.isArray(n)?t(n):n||t(o),r in e&&(r=t(e[r])),!~o.indexOf(r))throw Error("artoo.beep: wrong sound specified.");new Audio(artoo.settings.beep.endpoint+r+".ogg").play()},Object.defineProperty(artoo.beep,"available",{value:o}),Object.defineProperty(artoo.beep,"collections",{value:e}),o.forEach(function(t){artoo.beep[t]=artoo.beep.bind(artoo,t)});for(var n in e)artoo.beep[n]=artoo.beep.bind(artoo,n)}.call(this),function(){"use strict";artoo.settings={autoInit:!0,autoExec:!0,chromeExtension:!1,env:"dev",eval:null,reExec:!0,reload:!1,scriptUrl:null,beep:{endpoint:"//medialab.github.io/artoo/sounds/"},cache:{delimiter:"%"},dependencies:[],jquery:{version:"2.1.1",force:!1},log:{beeping:!1,enabled:!0,level:"verbose",welcome:!0},store:{engine:"local"}},artoo.loadSettings=function(t){artoo.settings=artoo.helpers.extend(t,artoo.settings)}}.call(this),function(){"use strict";function t(){}function e(){var t,o,n={},r=arguments.length;for(t=r-1;t>=0;t--)for(o in arguments[t])n[o]=n[o]&&a(arguments[t][o])?e(arguments[t][o],n[o]):arguments[t][o];return n}function o(t){return t instanceof Array}function n(t){return t instanceof Object}function r(t){return isNaN(t)&&"number"==typeof t}function a(t){return t instanceof Object&&!(t instanceof Array)&&!(t instanceof Function)}function i(t){return a(t)||o(t)}function s(t){return!i(t)}function l(t,e,o){for(var n=0,r=t.length;r>n;n++)if(e.call(o||null,t[n]))return t[n]}function c(t,e,o){for(var n=0,r=t.length;r>n;n++)if(e.call(o||null,t[n]))return n;return-1}function u(t){return artoo.$&&t instanceof artoo.$||jQuery&&t instanceof jQuery||$&&t instanceof $}function f(t){return t instanceof HTMLDocument||t instanceof XMLDocument}function h(t){var e=artoo.$;return f(t)?e(t):e("<div />").append(t)}function p(t,e){return t?document.implementation.createDocument(e||null,t,null):document.implementation.createHTMLDocument()}function d(t,e,o){"function"==typeof e&&(o=e,e=!1);var n=document.createElement("script");n.type="text/javascript",n.src=t,e&&(n.async=!0),n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n.onload=n.onreadystatechange=null,artoo.mountNode.removeChild(n),"function"==typeof o&&o())},artoo.mountNode.appendChild(n)}function m(t,e,o){var n=document.createElement(e?"link":"style"),r=document.getElementsByTagName("head")[0];n.type="text/css",e?(n.href=t,n.rel="stylesheet",n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n.onload=n.onreadystatechange=null,"function"==typeof o&&o())}):n.innerHTML=t,r.appendChild(n)}function g(){var t,e=Object.getPrototypeOf(w),o={};for(t in w)~t.indexOf("webkit")||t in e||w[t]===w||w[t]instanceof BarProp||w[t]instanceof Navigator||~j.indexOf(t)||(o[t]=w[t]);return o}function y(t,e,o){o=o||{},"object"==typeof e&&(o=e,e=o.done);var n=o.interval||30,r=0,a=setInterval(function(){t()&&(clearInterval(a),e(null)),o.timeout&&o.timeout-r*n<=0&&(clearInterval(a),e(new Error("timeout"))),r++},n)}function v(){var t=Array.prototype.slice.call(arguments);return setTimeout.apply(null,[t[0],0].concat(t.slice(1)))}function b(e,o,n){function r(){u.forEach(function(t){clearTimeout(t)})}function a(t,o){return f.push(o),t?(r(),c(t,f)):++h>=e.length?c(null,f):(i=e[l++],u.push(v(i,a)),void 0)}var i,s,l,c="function"==typeof o?o:o.done||n,u=[],f=[],h=0;for("function"!=typeof c&&(c=t),l=0,s=o.limit||e.length;s>l;l++)i=e[l],u.push(v(i,a))}function E(t,e){return function(){return e.apply(this,Array.prototype.slice.call(arguments)),t.apply(this,Array.prototype.slice.call(arguments))}}var w=this;Object.setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t};var x=new artoo.emitter;Object.setPrototypeOf(artoo,Object.getPrototypeOf(x)),artoo.hooks={trigger:function(t){artoo.emit(t)}};var j=["__commandLineAPI","applicationCache","chrome","closed","console","crypto","CSS","defaultstatus","defaultStatus","devicePixelRatio","document","external","frameElement","history","indexedDB","innerHeight","innerWidth","length","localStorage","location","name","offscreenBuffering","opener","outerHeight","outerWidth","pageXOffset","pageYOffset","performance","screen","screenLeft","screenTop","screenX","screenY","scrollX","scrollY","sessionStorage","speechSynthesis","status","styleMedia"];artoo.injectScript=function(t,e){d(t,e)},artoo.injectStyle=function(t,e){m(t,!0,e)},artoo.injectInlineStyle=function(t){m(t,!1)},artoo.waitFor=y,artoo.getGlobalVariables=g,artoo.helpers={before:E,createDocument:p,extend:e,first:l,indexOf:c,isArray:o,isDocument:f,isObject:n,isPlainObject:a,isRealNaN:r,isSelector:u,isNonScalar:i,isScalar:s,jquerify:h,noop:t,parallel:b}}.call(this),function(){"use strict";function t(t){var e={};return t.split("&").forEach(function(t){var o=t.split("=");e[decodeURIComponent(o[0])]=o[1]?decodeURIComponent(o[1]):!0}),e}function e(e){var o={href:e},n=e.split("://");n.length>1&&(o.protocol=n[0]),e=n[n.length>1?1:0];var r=e.split("@");if(r.length>1){var a=r[0].split(":");o.auth=a.length>1?{user:a[0],password:a[1]}:{user:a[0]},e=r[1]}var i=e.match(/([^\/:]+)(.*)/);if(o.host=i[1],o.hostname=i[1],i[2]){var s=i[2].trim();":"===s.charAt(0)&&(o.port=+s.match(/\d+/)[0],o.host+=":"+o.port),o.path="/"+s.split("/").slice(1).join("/"),o.pathname=o.path.split("?")[0].split("#")[0]}if(~o.hostname.search(".")){var l=o.hostname.split(".");if(4===l.length&&l.every(function(t){return!isNaN(+t)}))o.domain=o.hostname;else if(l.length>1){if(o.tld=l[l.length-1],o.domain=l[l.length-2],l.length>2){o.subdomains=[];for(var c=0,u=l.length-2;u>c;c++)o.subdomains.unshift(l[c])}}else o.domain=l[0]}var f=e.split("#");f.length>1&&(o.hash="#"+f[1]);var h=e.split("?");h.length>1&&(o.search="?"+h[1],o.query=t(h[1]));var p=o.pathname.split("/"),d=p[p.length-1].split(".");return d.length>1&&(o.extension=d[d.length-1]),o}function o(t){var e={};return t.split("\n").filter(function(t){return t.trim()}).forEach(function(t){if(t){var o=t.split(": ");e[o[0]]=o[1]}}),e}function n(t){var e={};return t.split("; ").forEach(function(t){var o=t.split("=");e[o[0]]=decodeURIComponent(o[1])}),e}artoo.parsers={cookies:n,headers:o,queryString:t,url:e}}.call(this),function(){"use strict";function t(t,e){return e=e||Object.keys(t),e.map(function(e){return t[e]})}function e(t){var e,o,n,r=[];for(n=0,e=t.length;e>n;n++)for(o in t[n])~r.indexOf(o)||r.push(o);return r}function o(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function n(n,r){r=r||{};var a,i=r.headers||[],s=l(n[0]),c=s&&(r.order||e(n)),u=r.escape||'"',f=r.delimiter||",";return i.length||s&&r.headers!==!1&&(i=c),a=(i.length?[i]:[]).concat(s?n.map(function(e){return t(e,c)}):n),a.map(function(t){return t.map(function(t){var e=(""+("undefined"==typeof t?"":t)).replace(new RegExp(o(u),"g"),u+u);return~e.indexOf(f)||~e.indexOf(u)||~e.indexOf("\n")?u+e+u:e}).join(f)}).join("\n")}function r(t,e){var o,n,r=t;if(0>=e)return"";for(n=1,o=0|e;o>n;n++)r+=t;return r}function a(t,e,o){if("string"==typeof t)return d.string(t);if("number"==typeof t)return d.number(t);if("boolean"==typeof t)return d.boolean(t);if("undefined"==typeof t||null===t||h(t))return d.nullValue(t);if(l(t))return d.object(t,e,o);if(c(t))return d.array(t,e);if("function"==typeof t)return d.fn(t);throw TypeError("artoo.writers.processYAMLVariable: wrong type.")}function i(t){return"---\n"+a(t)}function s(t,e){if(!l(t))throw Error("artoo.writers.queryString: wrong arguments.");var o,n="";for(o in t)n+=(n?"&":"")+o+"="+encodeURIComponent("function"==typeof e?e(t[o]):t[o]);return n}var l=artoo.helpers.isPlainObject,c=artoo.helpers.isArray,u=artoo.helpers.isScalar,f=artoo.helpers.isNonScalar,h=artoo.helpers.isRealNaN,p=/[:#,\-\[\]\{\}&%]|!{1,2}/,d={string:function(t){return~t.search(p)?"'"+t.replace(/'/g,"''")+"'":t},number:function(t){return""+t},array:function(t,e){if(e=e||0,!t.length)return"[]";var o,n,i="";for(n=0,o=t.length;o>n;n++)i+=r("  ",e),i+=u(t[n])?"- "+a(t[n])+"\n":l(t[n])?"-"+a(t[n],e+1,!0):a(t[n],e+1);return i},object:function(t,e,o){if(e=e||0,!Object.keys(t).length)return(e?"- ":"")+"{}";var n,i,s="",l=0;for(i in t)n=d.string(i),s+=r("  ",e),o&&!l&&(s=s.slice(0,-1)),s+=n+": "+(f(t[i])?"\n":"")+a(t[i],e+1)+"\n",l++;return s},fn:function(t){return d.string(t.toString())},"boolean":function(t){return""+t},nullValue:function(){return"~"}};artoo.writers={csv:n,queryString:s,yaml:i}}.call(this),function(){"use strict";function t(){var t=!0;for(var e in o.console.__proto__){t=!1;break}return t}function e(){return"undefined"==typeof window&&"undefined"!=typeof global&&"undefined"!=typeof module&&module.exports}var o=this,n="navigator"in o;artoo.browser={chrome:"chrome"in o,firefox:n&&!!~navigator.userAgent.search(/firefox/i),phantomjs:"callPhantom"in o,nodejs:e()},artoo.browser.which=artoo.helpers.first(Object.keys(artoo.browser),function(t){return artoo.browser[t]})||null,artoo.browser.firebug=t()}.call(this),function(t){"use strict";function e(t,e){return Array.prototype.slice.call(t,e||0)}function o(t){var e=artoo.settings.log.level;return artoo.helpers.isArray(e)?!!~e.indexOf(t):l.indexOf(t)>=l.indexOf(e)}function n(){return[(i?" ":"")+'  .-""-.   ',"  /[] _ _\\  "," _|_o_LII|_ ","/ | ==== | \\","|_| ==== |_|"," ||LI  o ||"," ||'----'||","/__|    |__\\"]}function r(t){var e=["[artoo]: "+(i?"%c"+t:"")];return i&&e.push("color: "+s[t]+";"),e.push("-"+(i?"":" ")),e}function a(t){artoo.log[t]=function(){artoo.log.apply(artoo.log,[t].concat(e(arguments)))}}var i=artoo.browser.chrome||artoo.browser.firebug,s={verbose:"#33CCFF",debug:"#000099",info:"#009900",warning:"orange",error:"red"},l=["verbose","debug","info","warning","error"];artoo.log=function(n){if(artoo.settings.log.enabled){var a=s[n]!==t,l=a?1:0,c=e(arguments,l);if(n=a?n:"debug",o(n)){var u=r(n).concat(c);console.log.apply(console,i?u:[u.reduce(function(t,e){return t+e},"")])}}};for(var c in s)a(c);artoo.log.plain=function(){artoo.settings.log.enabled&&console.log.apply(console,arguments)},artoo.log.welcome=function(){if(artoo.settings.log.enabled){var t=n();t[t.length-2]=t[t.length-2]+"    artoo.js",console.log(t.join("\n")+"   v"+artoo.version)}}}.call(this),function(){"use strict";var t=this,e={};artoo.deps={},artoo.deps._inject=function(o){var n=artoo.settings.dependencies;if(!n.length)return o();artoo.log.verbose("Starting to retrieve dependencies...",n.map(function(t){return t.name}));var r=n.map(function(o){if(!o.name||!o.globals||!o.url)throw Error("artoo.deps: invalid dependency definition.");var n="string"==typeof o.globals?[o.globals]:o.globals;return n.forEach(function(n){!t[n]||o.noConflict||o.force||(e[n]=t[n])}),function(r){artoo.injectScript(o.url,function(){artoo.log.verbose("Retrieved dependency "+o.name+".");var a={};n.forEach(function(n){a[n]=t[n],e[n]&&(t[n]=e[n],delete e[n]),o.noConflict&&t[n].noConflict()}),artoo.deps[o.name]=Object.keys(a).length>1?a:a[Object.keys(a)[0]],r()})}});artoo.helpers.parallel(r,function(){artoo.log.verbose("Finished retrieving dependencies."),o()})},artoo.jquery.inject=function(e){function o(t){return artoo.browser.phantomjs?(artoo.once("phantom:jquery",function(){t()}),artoo.phantom.requestJQuery(),void 0):artoo.injectScript(r,t)}var n=artoo.settings.jquery.version,r="//code.jquery.com/jquery-"+n+".min.js",a="undefined"!=typeof jQuery&&jQuery.fn||artoo.$.fn,i=!a&&"undefined"!=typeof $,s=a&&jQuery.fn.jquery?jQuery.fn.jquery:"0";a&&s.charAt(0)===n.charAt(0)?(artoo.log.verbose("jQuery already exists in this page (v"+s+"). No need to load it again."),artoo.$=jQuery,e()):artoo.settings.jquery.force?o(function(){artoo.log.warning("According to your settings, jQuery (v"+n+") was injected into your page to replace the current $ variable."),artoo.$=jQuery,e()}):a&&"2"!==s.charAt(0)||i?o(function(){artoo.$=jQuery.noConflict(!0),"undefined"==typeof t.$?(t.$=artoo.$,artoo.log.warning("jQuery is available but does not have a correct version. The correct version was therefore injected and $ was set since it was not used.")):artoo.log.warning("Either jQuery has not a valid version or another library using $ is already present. Correct version available through `artoo.$`."),e()}):o(function(){artoo.log.info("jQuery was correctly injected into your page (v"+n+")."),artoo.$=jQuery,e()})}}.call(this),function(){"use strict";function t(){artoo.browser.firebug||~console.log.toString().search(/\[native code\]/i)||(["log","info","debug","warn"].forEach(function(t){console[t]=console.__proto__[t]}),artoo.log.warning("The console have been shunted by the website you are visiting. artoo has repaired it."))}artoo.once("countermeasures",function(){t()})}.call(this),function(){"use strict";function t(){function t(){r.hooked||(XMLHttpRequest.prototype.open=e(XMLHttpRequest.prototype.open,function(t,e){var o=this;o._spy={method:t,url:e,params:artoo.parsers.url(e).query}}),XMLHttpRequest.prototype.send=e(XMLHttpRequest.prototype.send,function(t){var e=this;t&&(e._spy.querystring=t,e._spy.data=artoo.parsers.queryString(t)),r.listeners.forEach(function(t){"*"===t.criteria&&t.fn.call(e,e._spy)})}),r.hooked=!0)}function n(){r.hooked&&(XMLHttpRequest.prototype.send=o.send,XMLHttpRequest.prototype.open=o.open,r.hooked=!1)}var r=this;this.hooked=!1,this.listeners=[],this.before=function(e,o){"function"==typeof e&&(o=e,e=null),e=e||{},t(),this.listeners.push({criteria:"*",fn:o})},this.after=function(e,o){"function"==typeof e&&(o=e,e=null),e=e||{},t(),this.listeners.push({criteria:"*",fn:function(){var t=this,e=t.onreadystatechange;t.onreadystatechange=function(){if(t.readyState===XMLHttpRequest.prototype.DONE){var n=t.getResponseHeader("Content-Type"),r=t.response;if(~n.search(/json/))try{r=JSON.parse(t.responseText)}catch(a){}else~n.search(/xml/)&&(r=t.responseXML);o.call(t,t._spy,{data:r,headers:artoo.parsers.headers(t.getAllResponseHeaders())})}"function"==typeof e&&e.apply(t,arguments)}}})},this.off=function(t){var e=artoo.helpers.indexOf(this.listeners,function(e){return e.fn===t});if(!~e)throw Error("artoo.ajaxSniffer.off: trying to remove an inexistant listener.");this.listeners.splice(e,1),this.listeners.length||n()}}var e=artoo.helpers.before,o={open:XMLHttpRequest.prototype.open,send:XMLHttpRequest.prototype.send,setRequestHeader:XMLHttpRequest.prototype.setRequestHeader};artoo.ajaxSniffer=new t}.call(this),function(){"use strict";function t(e,o,n,r,a){function i(t){l.settings||o.settings?artoo.$.ajax(l.url||o.url||l,artoo.helpers.extend(l.settings||o.settings,{success:t,data:l.data||o.data||{},type:l.method||o.method||"get"})):artoo.$[l.method||o.method||"get"](l.url||o.url||l,l.data||o.data||{},t)}function s(a){var i=a;return(o.scrape||o.scrapeOne||o.jquerify)&&(a=artoo.helpers.jquerify(a)),o.scrape||o.scrapeOne?i=artoo[o.scrape?"scrape":"scrapeOne"](a.find(o.scrape.iterator),o.scrape.data,o.scrape.params):"function"==typeof o.process&&(i=o.process(a,n,r)),i===!1?o.done(r):(o.concat?r=r.concat(i):r.push(i),n++,artoo.helpers.isArray(e)&&n===e.length||n===o.limit?o.done(r):t(e,o,n,r,a),void 0)}r=r||[],n=n||0;var l="function"==typeof e?e(n,a):e[n];return l?(o.throttle>0?setTimeout(i,n?o.throttle:0,s):"function"==typeof o.throttle?setTimeout(i,n?o.throttle(n):0,s):i(s),void 0):o.done(r)}artoo.ajaxSpider=function(e,o,n){var r,a;o=o||{},"function"==typeof o&&(r=o,o={},o.done=r),"function"==typeof n&&(a=artoo.helpers.extend({done:n},o)),t(e,artoo.helpers.extend(a||o,{done:artoo.helpers.noop}))}}.call(this),function(){"use strict";function t(e,o,n){o=o||0;var r=e.canExpand?"string"==typeof e.canExpand?artoo.$(e.canExpand).length>0:e.canExpand(artoo.$):!0;if(!r||o>=e.limit)return"function"==typeof e.done&&e.done(),void 0;var a="string"==typeof e.expand?function(){artoo.$(e.expand).simulate("click")}:e.expand;if(e.throttle?setTimeout(a,"function"==typeof e.throttle?e.throttle(o):e.throttle,artoo.$):a(artoo.$),e.isExpanding)if("number"==typeof e.isExpanding)setTimeout(t,e.isExpanding,e,++o);else{var i="string"==typeof e.isExpanding?function(){return artoo.$(e.isExpanding).length>0}:e.isExpanding;artoo.waitFor(function(){return!i(artoo.$)},function(){t(e,++o)},{timeout:e.timeout})}else e.elements?(n=n||artoo.$(e.elements).length,artoo.waitFor(function(){return artoo.$(e.elements).length>n},function(){t(e,++o,artoo.$(e.elements).length)},{timeout:e.timeout})):t(e,++o)}artoo.autoExpand=function(e,o){if(e=e||{},e.done=o||e.done,!e.expand)throw Error("artoo.autoExpand: you must provide an expand parameter.");t(e)}}.call(this),function(){"use strict";artoo.autoScroll=function(t,e){artoo.autoExpand(this.helpers.extend(t,{expand:function(){window.scrollTo(0,document.body.scrollHeight)}}),e)}}.call(this),function(t){"use strict";function e(t){return t[0].documentElement&&t[0].documentElement.outerHTML||t[0].outerHTML}function o(t){return"string"==typeof t?{filename:t}:t||{}}function n(){this.defaultFilename="artoo_data",this.defaultEncoding="utf-8",this.xmlns="http://www.w3.org/1999/xhtml",this.mimeShortcuts={csv:"text/csv",tsv:"text/tab-separated-values",json:"application/json",txt:"text/plain",html:"text/html",yaml:"text/yaml"},this.createBlob=function(t,e,o){return e=this.mimeShortcuts[e]||e||this.defaultMime,new Blob([t],{type:e+";charset="+o||this.defaultEncoding})},this.createBlobFromDataURL=function(t){var e,o,n=atob(t.split(",")[1]),r=new Uint8Array(n.length);for(e=0,o=n.length;o>e;e++)r[e]=n.charCodeAt(e);return new Blob([r.buffer],{type:t.split(",")[0].split(":")[1].split(";")[0]})},this.blobURL=function(t){var e=i.createObjectURL(t);return e},this.saveResource=function(t,e){var o=document.createElementNS(this.xmlns,"a");o.href=t,o.setAttribute("download",e.filename||""),artoo.$(o).simulate("click"),o=null,e.revoke&&i.revokeObjectURL(t)},this.saveData=function(t,e){e=e||{};var o=this.createBlob(t,e.mime,e.encoding);this.saveResource(this.blobURL(o),{filename:e.filename||this.defaultFilename,revoke:e.revoke||!0})},this.saveDataURL=function(t,e){e=e||{};var o=this.createBlobFromDataURL(t);this.saveResource(o,{filename:e.filename||this.defaultFilename})}}var r=this,a=artoo.helpers,i=r.URL||r.webkitURL||r,s=new n;artoo.save=function(t,e){s.saveData(t,o(e))},artoo.saveJson=function(e,n){n=o(n),"string"!=typeof e?e=n.pretty||n.indent?JSON.stringify(e,t,n.indent||2):JSON.stringify(e):(n.pretty||n.indent)&&(e=JSON.stringify(JSON.parse(e),t,n.indent||2)),artoo.save(e,a.extend(n,{filename:"data.json",mime:"json"}))},artoo.savePrettyJson=function(t,e){e=o(e),artoo.saveJson(t,a.extend(e,{pretty:!0}))},artoo.saveYaml=function(t,e){e=o(e),artoo.save(artoo.writers.yaml(t),a.extend(e,{filename:"data.yml",mime:"yaml"}))},artoo.saveCsv=function(t,e){e=o(e),t="string"!=typeof t?artoo.writers.csv(t,e):t,artoo.save(t,a.extend(e,{mime:"csv",filename:"data.csv"}))},artoo.saveTsv=function(t,e){artoo.saveCsv(t,a.extend(o(e),{mime:"tsv",delimiter:"  ",filename:"data.tsv"}))},artoo.saveXml=function(t,n){n=o(n);var r=a.isSelector(t)&&e(t)||a.isDocument(t)&&t.documentElement.outerHTML||t,i=n.type||"xml",s="";if("html"===i&&a.isDocument(t)){var l=t.doctype;l&&(s="<!DOCTYPE "+(l.name||"html")+(l.publicId?' PUBLIC "'+l.publicId+'"':"")+(l.systemId?' "'+l.systemId+'"':"")+">\n")}else("xml"===i||"svg"===i)&&(~r.search(/<\?xml/)||(s='<?xml version="1.0" encoding="'+(n.encoding||"utf-8")+'" standalone="yes"?>\n'));"svg"===i&&(s+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'),artoo.save(s+r,a.extend(n,{mime:"html",filename:"document.xml"}))},artoo.saveHtml=function(t,e){artoo.saveXml(t,a.extend(o(e),{filename:"document.html",type:"html"}))},artoo.savePageHtml=function(t){artoo.saveHtml(document,a.extend(o(t),{filename:"page.html"}))},artoo.saveSvg=function(t,e){e=o(e);var n=artoo.$(t);if(!n.is("svg"))throw Error("artoo.saveSvg: selector is not svg.");artoo.saveXml(n,a.extend(e,{filename:"drawing.svg",type:"svg"}))},artoo.saveStore=function(t){t=o(t),artoo.savePrettyJson(artoo.store.get(t.key),a.extend(t,{filename:"store.json"}))},artoo.saveResource=function(t,e){s.saveResource(t,o(e))},artoo.saveImage=function(t,e){e=o(e);var n=artoo.$(t);if(!n.is("img")&&!n.attr("src"))throw Error("artoo.saveImage: selector is not an image.");var r=a.getExtension(n.attr("src")),i=n.attr("alt");artoo.saveResource(n.attr("src"),a.extend(e,{filename:i?i+(r?"."+r:""):!1}))}}.call(this),function(t){"use strict";function e(e,o){var n,r=artoo.$,a=e.sel?r(o).find(e.sel):r(o);return n="function"==typeof e?e.call(o,r):"function"==typeof e.method?e.method.call(a.get(),r):"string"==typeof e?"function"==typeof a[e]?a[e]():a.attr(e):e.attr!==t?a.attr(e.attr):a[e.method||"text"](),e.defaultValue&&!n&&(n=e.defaultValue),n}function o(t,n,r,a){var i=[],s=!!n.attr||!!n.method||n.scrape||"string"==typeof n||"function"==typeof n;r=r||{};var l;return l="function"==typeof t?artoo.$(t(artoo.$)):artoo.$(t),l.each(function(t){var a,l={};if(s)l="object"==typeof n&&"scrape"in n?o((n.sel?$(this).find(n.sel):$(this)).find(n.scrape.iterator),n.scrape.data,n.scrape.params):e(n,this);else for(a in n)l[a]="object"==typeof n[a]&&"scrape"in n[a]?o((n[a].sel?$(this).find(n[a].sel):$(this)).find(n[a].scrape.iterator),n[a].scrape.data,n[a].scrape.params):e(n[a],this);return i.push(l),!r.limit||t<r.limit-1}),i=r.one?i[0]:i,"function"==typeof a&&a(i),i}function n(t,e,o,n){var r,a,i,s;return artoo.helpers.isPlainObject(t)&&!artoo.helpers.isSelector(t)&&!artoo.helpers.isDocument(t)&&(t.iterator||t.data||t.params)?(a=t.data,i=artoo.helpers.isPlainObject(t.params)?t.params:{},r=t.iterator):(a=e,i=artoo.helpers.isPlainObject(o)?o:{},r=t),a=a||"text",s="function"==typeof n?n:"function"==typeof o?o:i.done,[r,a,i,s]}function r(t){var e=["scrape","scrapeOne","scrapeTable"];e.forEach(function(e){t.fn[e]=function(){return artoo[e].apply(artoo,[t(this)].concat(Array.prototype.slice.call(arguments)))}})}artoo.helpers.extend;artoo.scrape=function(t,e,r,a){var i=n(t,e,r,a);if(!i[0]||!i[1])throw TypeError("artoo.scrape: wrong arguments.");return o.apply(this,i)},artoo.scrapeOne=function(t,e,r,a){var i=n(t,e,r,a);return i[2]=artoo.helpers.extend(i[2],{limit:1,one:!0}),o.apply(this,i)},artoo.scrapeTable=function(t,o,n){o=o||{};var r,a="string"!=typeof t?t.selector:t;if(o.headers){var i=o.headers.type||o.headers.method&&"first"||o.headers,s=o.headers.method;if("th"===i)r=artoo.scrape(a+" th",s||"text");else if("first"===i)r=artoo.scrape(a+" tr:has(td):first td",s||"text");else{if(!artoo.helpers.isArray(i))throw TypeError("artoo.scrapeTable: wrong headers type.");r=i}return artoo.scrape(a+" tr:has(td)"+("first"===i?":not(:first)":""),function(){var t={};return r.forEach(function(n,r){t[n]=e(o.data||"text",$(this).find("td:eq("+r+")"))},this),t},o,n)}return artoo.scrape(a+" tr:has(td)",{scrape:{iterator:"td",data:o.data||"text"}},o,n)},artoo.jquery.plugins.push(r)}.call(this),function(){"use strict";function t(t){var e=artoo.settings.cache.delimiter;return t.charAt(0)===e&&t.charAt(t.length-1)===e}function e(e){if("local"===e)e=localStorage;else{if("session"!==e)throw Error('artoo.store: wrong engine "'+e+'".');e=sessionStorage}var o=function(t){return o.get(t)};return o.get=function(t){if(!t)return o.getAll();var n=e.getItem(t);try{return JSON.parse(n)}catch(r){return n}},o.getAll=function(){var n={};for(var r in e)t(r)||(n[r]=o.get(r));return n},o.keys=function(){var t,o=[];for(t in e)o.push(t);return o},o.set=function(t,o){if("string"!=typeof t&&"number"!=typeof t)throw TypeError("artoo.store.set: trying to set an invalid key.");e.setItem(t,JSON.stringify(o))},o.pushTo=function(t,e){var n=o.get(t);if(!artoo.helpers.isArray(n)&&null!==n)throw TypeError("artoo.store.pushTo: trying to push to a non-array.");
return n=n||[],n.push(e),o.set(t,n),n},o.update=function(t,e){var n=o.get(t);if(!artoo.helpers.isPlainObject(n)&&null!==n)throw TypeError("artoo.store.update: trying to udpate to a non-object.");return n=artoo.helpers.extend(e,n),o.set(t,n),n},o.remove=function(t){if("string"!=typeof t&&"number"!=typeof t)throw TypeError("artoo.store.set: trying to remove an invalid key.");e.removeItem(t)},o.removeAll=function(){for(var o in e)t(o)||e.removeItem(o)},o.clear=o.removeAll,o}artoo.createStore=e,artoo.store=e(artoo.settings.store.engine),artoo.s=artoo.store}.call(this),function(){"use strict";var t=0,e={};artoo.ui=function(o){function n(){var t=o.stylesheets||o.stylesheet;t&&(artoo.helpers.isArray(t)?t:[t]).forEach(function(t){this.injectStyle(t)},this)}o=o||{};var r=o.id||"artoo-ui"+t++;this.name=o.name||r,e[this.name]=this,this.mountNode=o.mountNode||artoo.mountNode,this.host=document.createElement("div"),this.host.setAttribute("id",r),this.mountNode.appendChild(this.host),this.shadow=this.host.createShadowRoot(),this.$=function(t){return t?artoo.$(this.shadow).children(t).add(artoo.$(this.shadow).children().find(t)):artoo.$(this.shadow)},this.injectStyle=function(t){if(!(t in artoo.stylesheets))throw Error("artoo.ui.injectStyle: attempting to inject unknown stylesheet ("+t+")");this.injectInlineStyle(artoo.stylesheets[t])},this.injectInlineStyle=function(t){var e=document.createElement("style");return e.innerHTML=artoo.helpers.isArray(t)?t.join("\n"):t,this.shadow.appendChild(e),this},this.kill=function(){this.mountNode.removeChild(this.host),delete this.shadow,delete this.host,delete e[this.name]},n.call(this)},artoo.ui.instances=function(t){return t?e[t]:e}}.call(this),function(){"use strict";function t(){return artoo.settings.reExec||n?(artoo.settings.eval?(artoo.log.verbose("evaluating and executing the script given to artoo."),eval.call(o,JSON.parse(artoo.settings.eval))):artoo.settings.scriptUrl&&(artoo.log.verbose('executing script at "'+artoo.settings.scriptUrl+'"'),artoo.injectScript(artoo.settings.scriptUrl)),n=!1,void 0):(artoo.log.warning("not reexecuting script as per settings."),void 0)}function e(){function t(t){artoo.jquery.inject(function(){artoo.jquery.plugins.map(function(t){t(artoo.$)}),t()})}artoo.emit("countermeasures"),artoo.settings.log.welcome&&artoo.log.welcome();var e=artoo.settings.log.beeping;e&&artoo.beep.greet(),artoo.browser.chromeExtension&&artoo.log.verbose("artoo has automatically been injected by the chrome extension."),artoo.helpers.parallel([t,artoo.deps._inject],function(){artoo.log.info("artoo is now good to go!"),artoo.settings.autoExec&&artoo.exec(),artoo.emit("ready")}),artoo.loaded=!0}var o=this,n=!0,r=document.getElementById("artoo_injected_script");r&&(artoo.loadSettings(JSON.parse(r.getAttribute("settings"))),r.parentNode.removeChild(r)),artoo.browser.chromeExtension=!!artoo.settings.chromeExtension,artoo.once("init",e),artoo.on("exec",t),artoo.init=function(){artoo.emit("init")},artoo.exec=function(){artoo.emit("exec")},artoo.settings.autoInit&&artoo.init()}.call(this);
